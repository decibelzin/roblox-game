-- Sistema de Spawn
local players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

-- Importar o mÃ³dulo de player para acessar os grupos
local PLAYER_DEFINITION = require(game.ReplicatedStorage.Shared.types["player.types"])
local cache = {
    player = {}
}
local PlayerModule = require(game.ServerScriptService.Server.framework.modules.player)(cache.player)

-- Importar configuraÃ§Ãµes de grupos
local GROUPS_CONFIG = require(game.ReplicatedStorage.Shared.groups)

-- Criar RemoteEvent para enviar mensagens do chat
local chatMessageEvent = ReplicatedStorage:FindFirstChild("ChatMessageEvent")
if not chatMessageEvent then
    chatMessageEvent = Instance.new("RemoteEvent")
    chatMessageEvent.Name = "ChatMessageEvent"
    chatMessageEvent.Parent = ReplicatedStorage
end

-- FunÃ§Ã£o para obter o grupo mais alto de um jogador
local function getHighestGroup(playerGroups)
    -- Verificar se playerGroups Ã© uma tabela vÃ¡lida
    if not playerGroups or type(playerGroups) ~= "table" then
        return nil
    end
    
    local highestGroup = nil
    local highestPriority = 0
    
    -- Prioridades dos grupos (maior nÃºmero = maior prioridade)
    local priorities = {
        owner = 4,
        admin = 3,
        moderator = 2,
        ["vip-gold"] = 1
    }
    
    for groupName, hasGroup in pairs(playerGroups) do
        if hasGroup and priorities[groupName] and priorities[groupName] > highestPriority then
            highestPriority = priorities[groupName]
            highestGroup = groupName
        end
    end
    
    return highestGroup
end

-- FunÃ§Ã£o para listar todos os grupos de um jogador
local function listPlayerGroups(playerGroups)
    -- Verificar se playerGroups Ã© uma tabela vÃ¡lida
    if not playerGroups or type(playerGroups) ~= "table" then
        return {}
    end
    
    local groups = {}
    for groupName, hasGroup in pairs(playerGroups) do
        if hasGroup then
            table.insert(groups, groupName)
        end
    end
    return groups
end

-- FunÃ§Ã£o para obter cor do grupo
local function getGroupColor(groupName)
    if groupName and GROUPS_CONFIG[groupName] then
        return GROUPS_CONFIG[groupName].color
    end
    return Color3.fromRGB(255, 255, 255) -- Cor padrÃ£o
end

-- FunÃ§Ã£o para aplicar tags ao jogador
local function applyPlayerTags(player)
    -- Obter dados do player
    local playerData, playerClass = PlayerModule.get(player, true)
    
    -- Obter o grupo mais alto
    local highestGroup = getHighestGroup(playerData.groups)
    
    -- Listar todos os grupos
    local allGroups = listPlayerGroups(playerData.groups)
    
    -- Mostrar informaÃ§Ãµes dos grupos
    if #allGroups > 0 then
        print("ğŸ“‹ Grupos de", player.Name, ":", table.concat(allGroups, ", "))
        print("ğŸ† Grupo mais alto:", highestGroup or "Nenhum")
    else
        print("âŒ Nenhum grupo encontrado")
    end
    
    -- Aplicar cor baseada no grupo
    if highestGroup then
        local groupColor = getGroupColor(highestGroup)
        print("ğŸ¨ Cor do grupo:", groupColor)
    else
        print("ğŸ“‹ Sem grupos atribuÃ­dos")
    end
    
    -- Enviar mensagem de boas-vindas
    local welcomeMessage = string.format("ğŸ‘‹ Bem-vindo, %s!", player.Name)
    if highestGroup then
        welcomeMessage = welcomeMessage .. string.format(" (Grupo: %s)", highestGroup)
    end
    chatMessageEvent:FireClient(player, welcomeMessage)
    
    print("â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”")
end

-- Eventos
players.PlayerAdded:Connect(function(player)
    print("ğŸ‘¤ Jogador entrou:", player.Name)
    
    player.CharacterAdded:Connect(function(character)
        wait(1) -- Aguardar o character carregar completamente
        
        print("Player spawnou:", player.Name)
        
        -- Aplicar tags do jogador
        applyPlayerTags(player)
    end)
end)

print("ğŸ® Sistema de Spawn iniciado!")

