local RegisterCommand = require(game.ReplicatedStorage.Shared["register-command"])
local Players = game:GetService("Players")
local ChatMessage = require(game.ServerScriptService.Server.framework.modules["chat-message"])
local PlayerItemsModule = require(game.ServerScriptService.Server.framework.modules["player-items"])
local ITEMS_CONFIG = require(game.ReplicatedStorage.Shared.itens)

RegisterCommand({
    name = "giveitem",
    description = "D√° um item para um jogador",
    aliases = { "gi", "item" },
    permissions = { "owner", "admin", "moderator" }
}, function(player, params, message)
    local username = params[1]
    local itemId = tonumber(params[2])
    local quantity = tonumber(params[3]) or 1
    
    -- Valida√ß√µes
    if not username or not itemId then
        ChatMessage.sendError(player, "‚ùå Uso: /giveitem <username> <itemId> [quantidade]")
        return
    end
    
    -- Verificar se o item existe
    if not ITEMS_CONFIG[itemId] then
        ChatMessage.sendError(player, "‚ùå Item ID '" .. itemId .. "' n√£o existe!")
        return
    end
    
    -- Buscar jogador
    local success, targetUserId = pcall(function()
        return Players:GetUserIdFromNameAsync(username)
    end)
    
    if not success then
        ChatMessage.sendError(player, "‚ùå Usu√°rio '" .. username .. "' n√£o encontrado!")
        return
    end
    
    local targetPlayer = Players:GetPlayerByUserId(targetUserId)
    if not targetPlayer then
        ChatMessage.sendError(player, "‚ùå Usu√°rio '" .. username .. "' n√£o est√° online!")
        return
    end
    
    -- Dar o item
    local addSuccess = PlayerItemsModule.addItem(targetPlayer, itemId, quantity)
    
    if not addSuccess then
        ChatMessage.sendError(player, "‚ùå Erro ao adicionar item!")
        return
    end
    
    local itemConfig = ITEMS_CONFIG[itemId]
    local itemName = itemConfig.name or "Item #" .. itemId
    
    ChatMessage.sendSuccess(player, "‚úÖ " .. quantity .. "x '" .. itemName .. "' dado(s) para " .. username .. "!")
    ChatMessage.sendSuccess(targetPlayer, "üéÅ Voc√™ recebeu " .. quantity .. "x '" .. itemName .. "'!")
end)

